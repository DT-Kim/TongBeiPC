<!DOCTYPE html>
<html>

	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<title>用户专查 - 铜呗后台管理系统</title>

		<meta name="description" content="overview &amp; stats" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

		<!-- bootstrap & fontawesome -->
		<link rel="stylesheet" href="assets/css/bootstrap.min.css" />
		<link rel="stylesheet" href="assets/font-awesome/4.5.0/css/font-awesome.min.css" />

		<!-- page specific plugin styles -->
		
		<!--tree-->
		<link href="assets/tree/css/ligerui-tree.css" rel="stylesheet" type="text/css" />

		<!-- text fonts -->
		<link rel="stylesheet" href="assets/css/fonts.googleapis.com.css" />

		<!-- ace styles -->
		<link rel="stylesheet" href="assets/css/ace.min.css" class="ace-main-stylesheet" id="main-ace-style" />

		<!--[if lte IE 9]>
			<link rel="stylesheet" href="assets/css/ace-part2.min.css" class="ace-main-stylesheet" />
		<![endif]-->
		<link rel="stylesheet" href="assets/css/ace-skins.min.css" />
		<link rel="stylesheet" href="assets/css/ace-rtl.min.css" />

		<!--[if lte IE 9]>
		  <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
		<![endif]-->

		<!-- inline styles related to this page -->

		<!-- ace settings handler -->
		<script src="assets/js/ace-extra.min.js"></script>

		<!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

		<!--[if lte IE 8]>
		<script src="assets/js/html5shiv.min.js"></script>
		<script src="assets/js/respond.min.js"></script>
		<![endif]-->
	    <style type="text/css">
	    	.chose,.clear{
	    		margin-left: 20px;
	    	}
	    	.tpsc
	    	{
	    		margin-top: 20px;
	    		margin-left: 20px;
	    	}
	    	.clearyc
	    	{
	    		clear: both;
	    	}
	    	.jiange
	    	{
	    		margin-top: 15px;
	    	}
	    	.textset
	    	{
	    		width: 420px;
	    		margin-left: 20px;
	    	}
	    	.bc
	    	{
	    		margin-left: 10px;
	    		background-color: rgb(67, 142, 185);
	    		color: #FFFFFF;
	    		width: 50px;
	    		height: 30px;
	    	}
	    	.First_p,.Second_p,.Third_p
	    	{
	    		margin-left: 10px;
	    		
	    	}
	    	.time_set
	    	{
	    		margin-top:15px ;
	    	}
	    	.select
	    	{
	    		margin-left: 10px;
	    	}
	    	.time_bc
	    	{
	    		margin-left: 50px;
	    		background-color: rgb(67, 142, 185);
	    		color: #FFFFFF;
	    		width: 100px;
	    		height: 40px;
	    	}
	    </style>
	</head>

	<body class="no-skin">
		<!--top part begin-->
        <div id="top"></div>
        <!--top part end-->

		<div class="main-container ace-save-state" id="main-container">

			<!--left tree begin-->
            <div id="leftTree" class="sidebar responsive ace-save-state"></div>
            <!--left tree end-->

			<div class="main-content">
			    <div class="widget-main padding-24">
                    <span style="font-size: 22px;">广告设置 </span>
                    <div class="hr hr8 hr-double hr-dotted"></div>
                    <div class="col-xs-12">
                        <button class="btn btn-primary" id="showDetali"> 保存 </button>
                    </div>
                    <div class="col-xs-8">
                        <div class="widget-box">
                            <div class="widget-header widget-header-flat">
                                <h4 class="widget-title smaller">广告</h4>
                                <h4 class="widget-title smaller" id="ProName"></h4>
                            </div>
                            <div class="tabbable">
                                <ul class="nav nav-tabs padding-12">
                                    <li class="active">
                                        <a data-toggle="tab" href="#set1">图片设置 </a>
                                    </li>
                                    <li>
                                        <a data-toggle="tab" href="#set2">文字设置 </a>
                                    </li>
                                    <li>
                                        <a data-toggle="tab" href="#set3">轮播状态设置 </a>
                                    </li>
                                </ul>
                            <div class="tab-content">
                               <!-- 图片设置-->
                                <div id="set1" class="tab-pane in active tpsc " >
           						 	<div class="btn_wrapper">
                					<!--不使用file的默认样式,隐藏file选择框,使用button的click事件触发选择文件-->
	                					<input type="file" name="files" id="files" multiple style="display: none;"  data-name="files1"/>
			                			<button class="btn btn-primary " id="xzbtn">选择文件</button>
			                			<button class="clearBtn btn btn-primary clear">清空文件</button>
			                			<button class="uploadBtn btn btn-primary chose ">上传文件</button>
                  					</div>
                  					<div class="img_wrapper">
                               		 </div>
                			    </div>
                			    <div class="clearyc"></div><!--清楚浮动-->
                			    <!--图片over-->
                			    <!--文字设置-->
                			    <div id="set2" class="tab-pane">
	                			    <div class="jiange">
		                			    <label>图片一:</label> 
		                			    <input type="text" id="photo1" class="textset"/>
		                			    <button class="bc">保存</button>
	                			    </div>
	                			    <div class="jiange">
		                			    <label>图片二:</label> 
		                			    <input type="text" id="photo2" class="textset" />
		                			    <button class="bc">保存</button>
	                			    </div>
	                			    <div class="jiange">
	                			        <label>图片三:</label>
	                			        <input type="text" id="photo3" class="textset" />
	                			        <button class="bc">保存</button>
	                			        </div>
                			    </div>
                			    <!--文字设置over-->
                			    <!--轮播设置-->
                			    <div id="set3" class="tab-pane">
                			    	<div>
                			    		<span>图片顺序：</span> 
                			    	    <span class="First_p"> First：
                			    	    	<select id="set_time" class="select">
											    <option value="photo1">图片一</option>1
											    <option value="photo2">图片二</option>
											    <option value="photo3">图片三</option>
										    </select>
                			    	    </span>
	                			    	<span class="Second_p">Second：
	                			    		<select id="set_time" class="select">
											    <option value="photo1">图片一</option>1
											    <option value="photo2">图片二</option>
											    <option value="photo3">图片三</option>
										    </select>
	                			    	</span>
                			       		<span class="Third_p">Third：
                			       			<select id="set_time" class="select">
											    <option value="photo1">图片一</option>1
											    <option value="photo2">图片二</option>
											    <option value="photo3">图片三</option>
										    </select>
                			       		</span>
                			    	</div>
                			    	<div id="jgtime" class="time_set">间隔时间： 
                			    		<select id="set_time" class="select">
										    <option value="0.5s">0.5s</option>1
										    <option value="1s">1s</option>
										    <option value="2s">2s</option>
										    <option value="5s">5s</option>
										    <option value="10s">10s</option>
										    <option value="自定义">自定义</option>
										</select>
										<button class="time_bc">保存设置</button>
                			    	</div>
										
                			    </div>
                			   <!-- 轮播over-->
                        </div>
                        </div>
                        <div class="space-6"></div>
                    </div>
                </div>
			</div>
			</div>
			<!--footer part begin-->
            <div id="footer" class="footer"></div>
            <!--footer part end-->
			

	
		</div>

		<script src="assets/js/jquery-2.1.4.min.js"></script>
		<script src="assets/js/bootstrap.min.js"></script>
		<!--dataTable-->
        <script src="assets/js/jquery.dataTables.min.js"></script>
        <script src="assets/js/jquery.dataTables.bootstrap.min.js"></script>
        <script src="assets/js/dataTables.buttons.min.js"></script>
        <script src="assets/js/dataTables.select.min.js"></script>
		<!--ace-->
		<script src="assets/js/ace-elements.min.js"></script>
		<script src="assets/js/ace.min.js"></script>
        <!--图片上传-->
        <script src="assets/js/self/ads_set.js"></script>
	    <script src="assets/js/jquery-ui.min.js"></script>

		<script type="text/javascript">
			    /*
		     * INI Page
		     */
            $("#top").load("pageTop.html")
            $("#leftTree").load("pageLeft.html")
            $("#footer").load("pageFoot.html")
			var toast;
   			 $(document).ready(function() {
		        toast = new PomeloToast();
		        //选择文件点击事件
		        $("#xzbtn").click(function(e){
		            e.preventDefault(); 
		            $("#files").trigger("click");
		        });
		        //保存文件数组
		        var imgFiles = [];
		        //记录当前文件数
		        var fileCount = 0;
		        //文件变化事件
		        $("#files").change(function() {
		            var files = $(this)[0].files;
		            var imageType = /^image\//;
		            var namePrefix = $(this).data("name");
		            for(var i = 0;i < files.length;i ++) {
		                var file = files[i];
		                var fileType = file.type;
		                if(!imageType.test(fileType)) {
		                    toast.show("请选择图片类型文件");
		                    return;
		                }
		                var fileName = file.name;
		                //文件的唯一标识
		                fileCount++;
		                var fileId = namePrefix + '_' + fileName + '_' + fileCount;
		                //保存文件到数组
		                imgFiles.push({
		                    id : fileId,
		                    file : file
		                });
		                //预览图片
		                var render = new FileReader();
		                render.fileId = fileId;
		                render.img = $(this);
		                render.onload = function (e) {
		                //创建img
		                var imgHtml = '<div class="dragWrapper" style="margin-top:10px; float:left; ">' +
		                    '<img src="' + e.target.result + '" width="100" height="100" data-name="' + e.target.fileId + '" />' +
		                    '<button class="btn-default removeImg" style="margin-left:5px; margin-right:5px;">删除</button>' + '</div>';
		                    e.target.img.parent().siblings(".img_wrapper").append(imgHtml);
		                };
		                render.readAsDataURL(files[i]);
		            }
		            //清空file框文件,可以连续选择同一文件
		            $(this).val('');
		            //刷新拖动排序
		            $(".container").sortable('refresh');
		        });
		        //删除单个文件,因为动态添加,所以使用代理
		        $(".img_wrapper").on("click", ".removeImg", function() {
		            var id = $(this).siblings("img").data("name");
		             var index = 0;
		            //删除文件
		            while(index < imgFiles.length) {
		                if(imgFiles[index].id == id) {
		                    imgFiles.splice(index, 1);
		                    break;
		                }
		                index++;
		            }
		            $(this).parent().remove();
		        });
		        //清空文件
		        $(".clearBtn").click(function() {
		            //清空文件数组
		            imgFiles = [];
		            $(".img_wrapper").html('');
		        });
		        //图片拖动排序
		        $(".container").sortable({
		            items:'.dragWrapper'
		        });
		        var uploadFinish = true;
		        //上传文件
		        $(".uploadBtn").click(function() {
		            if(imgFiles.length < 1) {
		                toast.show("文件为空");
		                return;
		            }
		            if(!uploadFinish) {
		                //文件正在上传
		                return;
		            }
		            uploadFinish = false;
		            var formData = new FormData();
		            //设置文件顺序
		            $.each($("div.img_wrapper"), function(index, value) {
		                var imgs = $(this).find("img");
		                var imgOrder = 1;
		                $.each(imgs, function() {
		                    $(this).attr("data-order", imgOrder);
		                    imgOrder++;
		                });
		            });
		            //设置文件参数 key:name+order value:file
		            $.each(imgFiles, function(index, value) {
		                var id = value.id;
		                //获取该图片对应的顺序
		                var order = $("img[data-name='" + id + "']").data("order");
		                id = id.substr(0, id.lastIndexOf("_"));
		                id = id + "_" + order;
		                formData.append(id, value.file);
		            });
		
		           $.ajax({
//		                url: 'http://localhost:8080/test/uploads',
		                data: formData,
		                type: 'POST',
		                cache: false,
		                contentType: false,
		                processData: false,
		                success: function(data){
		                    toast.show("上传成功");
		                    //清空文件数组
		                    imgFiles = [];
		                    //清空预览图片
		                    $(".img_wrapper").html('');
		                },
		                error: function(e) {
		                    toast.show("上传失败");
		                },
		                complete: function() {
		                    //设置请求完成
		                    uploadFinish = true;
		                }
		            });
		
		        });
		
		    });
		</script>
	</body>

</html>
